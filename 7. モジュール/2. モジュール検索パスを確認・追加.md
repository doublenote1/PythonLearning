# 概要

> Pythonのimport文で標準ライブラリやpipでインストールしたパッケージ、
  自作のパッケージなどをインポートするときに探索されるパスを
  「モジュール検索パス」と呼ぶ。
> 自作のパッケージやモジュールをインポートしたい場合は
  正しく設定しておく必要がある。

> ここではimportの対象となるディレクトリのパスである
  「モジュール検索パス」を確認したり新たに追加したりする方法を説明する。

# 「モジュール検索パス」を確認

> 「モジュール検索パス」は
  標準ライブラリの`sys`モジュールの`sys.path`に格納されている。

> `sys.path`はディレクトリのパスを
  文字列として格納したリストオブジェクトなので
  `print()`で中身を確認できる。

> ここでは`pprint`を使って見やすくしている。

```python
import sys
import pprint

pprint.pprint(sys.path)
# -> ['D:\\Documents\\Projects\\Python Learning',
# ->  ...,
# ->  'D:/Documents/Projects/Python Learning']
```

> 結果は環境によって異なるが、
    1. スクリプトファイルがあるディレクトリ
    2. 環境変数`PYTHONPATH`で指定したディレクトリ(後述)
    3. カレントディレクトリ
    4. 標準ライブラリのためのディレクトリ(3つ)
    5. pipでインストールしたサードパーティライブラリのための
       site-packagesディレクトリ
  が格納されている。

> スクリプトファイルを実行する場所によって
  インポートがうまくいったりいかなかったりするのは、
  カレントディレクトリによって「モジュール検索パス」が変わっているのが原因。

> また、`sys.path`の先頭から優先してモジュールを探索するため、
  標準ライブラリと同じ名前のファイルが
  スクリプトファイルと同じディレクトリにあるとそちらがインポートされる。
  インポートはされているのに想定の関数などが使えない場合はこれが原因。
  該当ファイルをリネームすればOK。

# 「モジュール検索パス」を追加

> `sys.path`はただのリストオブジェクトなので、
  `append()`メソッドなどで新たなパスを追加することが可能。

> `sys.path`にパスを追加したあとでインポートを行うと、
  追加したパスの中のモジュールがインポートできる。

> 例えばスクリプトファイルの一階層上のディレクトリを追加する場合は
  以下のように書ける。

```python
import os
import pprint
import sys

"スクリプトファイルの一階層上のディレクトリ"
dir_up = os.path.join(os.path.dirname(__file__), '..')
print(dir_up)
# -> D:/Documents/Projects/Python Learning/7. モジュール\..

sys.path.append(dir_up)
pprint.pprint(sys.path)
# -> [...,
# ->  ...,
# ->  'D:/Documents/Projects/Python Learning/7. モジュール\\..']
```

> `sys.path`への追加が有効なのはそのコードの中だけ。
  恒久的に特定のパスを追加したい場合は
  次に説明する`PYTHONPATH`か.pthファイルを使う。

# 環境変数「PYTHONPATH」で「モジュール検索パス」を追加

> 恒久的に「モジュール検索パス」を追加する場合は、
  環境変数`PYTHONPATH`を使う。

> 自作のライブラリを
  標準ライブラリやpipでインストールしたサードパーティライブラリのように
  使いまわしたい場合は、
  自作ライブラリをまとめて格納するディレクトリを作って、
  そのディレクトリのパスを環境変数`PYTHONPATH`に設定する。

> Windowsの場合も通常の環境変数と同様に
  「システム」→「システムのプロパティ」→「環境変数」から
  `PYTHONPATH`を新たに追加して設定すればOK。
  Windowsの場合は複数パスを指定する場合セミコロン;で区切る。

> 自作のライブラリを`PYTHONPATH`に追加したディレクトリに入れておけば
  `sys.path`を処理することなくいつでもインポートして使えるようになる。

# パス設定ファイル(.pth)で「モジュール検索パス」を追加

> site-packagesディレクトリの中にパス設定ファイル(.pth)を置いておくと、
  その中身のパスも「モジュール検索パス」として追加される。

> パス設定ファイル(.pth)には1行に1つのパスを記述する。
  相対パスでも絶対パスでもOK。
  `#`でコメントを書くことも可能。
  拡張子が`pth`であればファイル名は何でもよい。

# リンク

[note.nkmk.me](https://note.nkmk.me/python-import-module-search-path/)
