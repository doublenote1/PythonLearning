> 数値や文字列を様々な書式に変換(フォーマット)する場合、
  組み込み関数`format()`または文字列メソッド`str.format()`を使う。

> Python3.6から文字列メソッド`str.format()`をより簡潔に記述できる
  f文字列(f-strings)が追加された。以下の記事を参照。
[note.nkmk.me](https://note.nkmk.me/python-f-strings/)

---------------------------------------------------------------------------

# 組み込み関数format()

[docs.python.org](https://docs.python.org/ja/3/library/functions.html#format)

`書式化された文字列 = format(value, format_spec)`

> <value>:       元の値 / 文字列strや数値int, floatなど
  <format_spec>: 書式指定子 / 文字列str
  返り値:        書式化された文字列str

> ここでは第一引数に数値リテラルや文字列リテラルをそのまま使っているが、
  もちろんそれらの値が格納された変数でも構わない。

```python
s = format(255, '04x')
print(s)  # -> 00ff
print(type(s))  # -> <class 'str'>
print(format('center', '*^16'))  # -> *****center*****
```

# 文字列メソッドstr.format()

`書式化された文字列 = 
置換元文字列.format(*args, **kwargs)`

「置換フィールド」の書式: `{[フィールド名][!変換指定子][:書式指定子]}`

> 「置換元文字列」に「置換フィールド」を埋め込む(複数埋め込み可能)

> 引数には左から順番にインデックス番号が割り当てられる
> 引数にはキーワードを指定することもできる
> 辞書やリストも引数にできる

> 置換フィールド内の「フィールド名」にてインデックスもしくは
  キーワードを指定すると対応する引数の値が渡される
> 置換フィールドの総数以上の引数が存在すれば、
  置換フィールドのすべてのフィールド名なら省略できる
  (引数の左から順番に置換フィールドに渡される)

> 「書式指定子」は「置換フィールド」`{}`内に`:`に続けて記述する。

```python
s = '{:04x}'.format(255)
print(s)  # -> 00ff
print(type(s))  # -> <class 'str'>
print('{:*^16}'.format('center'))  # -> *****center*****
```

## 置換フィールドに対する引数の指定

### 順番通りに引数を指定(デフォルト)

> 置換フィールド`{}`は複数存在してもよく、
  デフォルトではメソッドの引数が順番に処理される。
> `{}`内の書式指定子を省略すると`str()`で文字列に変換するだけになる。

> 文字列中に変数の値を挿入してprintで表示する場合などに便利。

```python
print('{}-{}-{}'.format('100', '二百', 300))  # -> 100-二百-300
```

### インデックスで位置引数を指定

> `{0}`や`{1}`のように`{}`内にインデックスを指定すると
  引数の順番に応じて出力される。
> 同じ番号を繰り返し使うこともできる。
> 文字列中に同じ値を挿入したい場合は便利。

```python
print('{0}-{1}-{0}'.format('foo', 'bar'))  # -> foo-bar-foo
```

### 任意の名前(文字列)でキーワード引数を指定

> `{}`内に任意の名前を指定し、キーワード引数として入力することも可能。

```python
print('{year}年{month}月{day}日'.format(year=2018, month=1, day=11))
# -> 2018年1月11日
```

### リスト、辞書を引数に指定

> 置換フィールド内でリスト型引数のインデックスや辞書型引数のキーを
  `<引数のインデックス>[<要素のインデックス>]`で指定する。
> 辞書のキーの指定では引用符`'`や`"`は使わないので注意。

> 同じ引数を繰り返し使う場合は上述のように
  インデックスや文字列(名前)を指定する必要がある。

```python
lst = ['one', 'two', 'three']
print('{0[0]}-{0[1]}-{0[2]}'.format(lst))  # -> one-two-three

dic1 = {'name': 'Alice', 'age': 20}
dic2 = {'name': 'Bob', 'age': 30}
print('{0[name]} is {0[age]} years old.\n'\
      '{1[name]} is {1[age]} years old.'.format(dic1, dic2))
# -> Alice is 20 years old.
# -> Bob is 30 years old.
```

> リストに`*`をつけて引数に指定することで位置引数として展開したり、
  辞書に`**`をつけて引数に指定することで
  キーワード引数として展開することも可能。
[関連記事](../../../6.%20制御フロー/1.%20関数定義.md#「可変長パラメータ」・「キーワード専用パラメータ」の詳細)

```python
lst = ['one', 'two', 'three']
print('{}-{}-{}'.format(*lst))  # -> one-two-three

dic = {'name': 'Alice', 'age': 20}
print('{name} is {age} years old.'.format(**dic))
# -> Alice is 20 years old.
```

## 波括弧{}の記述

> `format()`メソッド内で波括弧`{`,`}`を書きたい場合は`{{`,`}}`のように
  2回繰り返して書く。
> バックスラッシュ`\`ではエスケープできないので注意。

```python
print('{{}}-{num}-{{{num}}}'.format(num=100))  # -> {}-100-{100}
```

## 書式指定子の記述

> いずれの場合も、書式を指定するには`{}`内の整数値や名前の文字列のあと
  `:書式指定子`のように書く。

```python
print('{num:x}'.format(num=255))  # -> ff
print('{year}年{month:02}月{day:02}日'.format(year=2018, month=1, day=11))
# -> 2018年01月11日
```

# 書式指定子の種類

> 以下、「書式指定子」による書式の指定方法について説明する。
> サンプルコードでは文字列メソッド`str.format()`を使うが、
  組み込み関数`format()`でも同様の書式指定子が使用できる。
> 組み込み関数`format()`では第二引数に書式指定子を指定する。


> ====== 書式指定子の構文 ======

[docs.python.org](https://docs.python.org/ja/3.7/library/string.html#format-specification-mini-language)

書式指定子:
`:[[埋め文字]揃え方向][符号][別形式][ゼロ埋め][最小フィールド幅]
[桁区切り][.精度][表現型]`

> 埋め文字(fill):
    * 揃え方向を指定したときで、埋め込まれる内容が、この置換フィールドの
      最小幅よりも少ないときに余った部分を埋める文字を指定する
    * デフォルトは空白文字

> 揃え方向(align):
    `<`: 左寄せ(ほとんどのオブジェクトにおいてのデフォルト)
    `>`: 右寄せ(いくつかのオブジェクトにおいてのデフォルト)
    `^`: 中央揃え
    `=`: 数値のみ右揃えにし符号は離す
         (「最小フィールド幅」の直前が`0`の時はこれがデフォルト)
[関連記事](#埋め文字・揃え方向)

> 符号(sign):
    `+`: 正負表示
    `-`: 負のみ表示(デフォルト)
    ` `: 負のみ表示(正は半角空白)
[関連記事](#符号)

> 別形式:
    `#`:
    * 変換方法を「別形式」に切り替える
    * 異なる型に対してそれぞれの形式で出力される
    * 整数、浮動小数点数、複素数、10進数の型でのみ有効
    * 「表現型(type)」に下記のオプションを指定したとき
       それぞれの接頭辞を加える様になる
         `b`(2進数):      '0b'
         `o`(8進数):      '0o'
         `x`,`X`(16進数): '0x'
    * 浮動小数点数・複素数・10進数に対する「別形式」:
       小数点文字の後に数字がなくても変換結果には常に小数点文字が含まれる
       通常は、数字が続く場合にのみ小数点文字がこれらの変換結果に現われる
       さらに、`g`と`G`の変換については、最後の0は結果から取り除かれない

> ゼロ埋め:
    `0`: 余白を0で埋めます(埋め文字`>`が優先される)
[関連記事](#ゼロ埋め)

> 最小フィールド幅(width):
    変換後の最小文字数を整数で指定します

> 桁区切り(grouping_option):
    `,`: 3桁ごとにカンマ','を挿入する(10進数表記でのみ使用可能)
    `_`: 10進数の場合は3桁ごとに、
         2・8・16進数の場合は4桁ごとにアンダースコア'_'を表示する
[関連記事](#桁区切り)

> 精度(.precision):
    `.<有効桁数>`
      「表現型」に応じて挙動が変わる

> 表現型:
    値の型ごとに表現方法を指定できます(下記を参照)


> ====== 表現型 ======

> --- 整数向け ---
`d`: 	 10 進数(デフォルト)
`b`: 	 2 進数
`o`: 	 8 進数
`x`,`X`: 16 進数(小文字・大文字)
`n`: 	 ロケールに従い区切り文字を挿入。それ以外はdと同じ
`c`: 	 数値をUnicode文字に変換

> --- 浮動小数点数向け ---
`f`,`F`:  固定小数点数(nan, infの小文字・大文字)。デフォルトの精度は6
`e`,`E`:  指数表記。デフォルトの精度は6
`g`,`G`:  指数部が-4以上または精度以下で固定小数点数(`f`, `F`)
          それ以外は指数表記(`e`, `E`)になります
          デフォルトの精度は6
`n`:      ロケールに従い区切り文字を挿入。それ以外はgと同じ
`%`:      数値が 100 倍されパーセント記号'%'付きになります
指定なし: `g`に近く、固定小数点数では少なくとも小数点以下が一桁
          デフォルトの精度は数値の高さと同じです

[docs.python.org](https://docs.python.org/ja/3/library/stdtypes.html#str.format)

## 埋め文字・揃え方向

> `<`、`^`、`>`で左寄せ、中央寄せ、右寄せなどのアラインメントができる。
> 全体の文字数を数値で指定する

```python
print('"{:<10}"'.format(100))  # -> "100       "
print('"{:^10}"'.format(100))  # -> "   100    "
print('"{:>10}"'.format(100))  # -> "       100"
```

> 埋める文字を指定することもできる。上の例のように省略するとスペース。
> 一文字であれば全角でもOK。

```python
print('{:*<10}'.format(100))   # -> 100*******
print('{:a^10}'.format(100))   # -> aaa100aaaa
print('{:鬼>10}'.format(100))  # -> 鬼鬼鬼鬼鬼鬼鬼100
```

> `>`による右寄せは符号(`-`, `+`)が考慮されない。
> `=`を使うと符号のあとに続いて指定した文字で埋められる。

```python
print('{:0>10}'.format(-100))  # -> 000000-100
print('{:0=10}'.format(-100))  # -> -000000100
```

> `<`、`^`、`>`は文字列に対しても指定できるが、`=`はValueErrorになる
> 文字列に対して`=`で処理したい場合は`int()`などで数値に変換する必要がある

```python
try:
    print('{:0=10}'.format('-100'))
except ValueError as e:
    print(e)  # -> '=' alignment not allowed in string format specifier

print('{:0=10}'.format(int('-100')))  # -> -000000100
```

> 浮動小数点数floatでも同様。小数点も一文字にカウントされる

```python
print('{:*<10}'.format(1.23))   # -> 1.23******
print('{:a^10}'.format(1.23))   # -> aaa1.23aaa
print('{:鬼>10}'.format(1.23))  # -> 鬼鬼鬼鬼鬼鬼1.23

print('{:0>10}'.format(-1.23))  # -> 00000-1.23
print('{:0=10}'.format(-1.23))  # -> -000001.23
```

> 左寄せ、中央寄せ、右寄せについては`ljust()`, `center()`, `rjust()`という
  専用の文字列メソッドもある
[関連記事](../5.%20文字列操作/3.%20文字列・数値を右寄せ、中央寄せ、左寄せ.md)

## 符号

> デフォルトでは負の数にのみ符号`-`が表示される。
> 書式指定子に`+`をつけると正の数にも符号`+`が表示される。
> スペースをつけると正の数の先頭に一文字分のスペースが表示され、
  負の数と桁数が揃う。

```python
print('"{}"'.format(100))     # -> "100"
print('"{}"'.format(-100))    # -> "-100"

print('"{:+}"'.format(100))   # -> "+100"
print('"{:+}"'.format(-100))  # -> "-100"

print('"{: }"'.format(100))   # -> " 100"
print('"{: }"'.format(-100))  # -> "-100"
```

> 後述の「ゼロ埋め」など任意の文字で埋める場合は注意が必要。
> `+`もスペースもつけないデフォルトでは正の数が一文字多く埋められてしまう

```python
print('"{:06}"'.format(100))    # -> "000100"
print('"{:06}"'.format(-100))   # -> "-00100"

print('"{:+06}"'.format(100))   # -> "+00100"
print('"{:+06}"'.format(-100))  # -> "-00100"

print('"{: 06}"'.format(100))   # -> " 00100"
print('"{: 06}"'.format(-100))  # -> "-00100"
```

> アラインメント記号を使う場合は、
  アラインメント記号のあとに符号の指定記号を書く。

```python
print('{:_>6}'.format(100))    # -> ___100
print('{:_>6}'.format(-100))   # -> __-100

print('{:_>+6}'.format(100))   # -> __+100
print('{:_>+6}'.format(-100))  # -> __-100

print('{:_> 6}'.format(100))   # -> __ 100
print('{:_> 6}'.format(-100))  # -> __-100
```

## ゼロ埋め

> ゼロ埋めして桁数を合わせたい場合は
  `0`オプションの後に「最小フィールド幅」を表記する。

```python
print('{:010}'.format(100))    # -> 0000000100
print('{:010}'.format(-100))   # -> -000000100
```

> `=`として処理されるので、以下のように引数に文字列を指定すると
  エラーになってしまう

```python
try:
    print('{:010}'.format('-100'))
except ValueError as e:
    print(e)  # -> '=' alignment not allowed in string format specifier
```

> ゼロ埋めについては`zfill()`という専用の文字列メソッドもある。
> 以下の記事を参照。
[関連記事](../5.%20文字列操作/4.%20文字列・数値をゼロ埋め.md#右寄せゼロ埋め:zfill())

## 桁区切り

> 10進数は3桁または4桁ごとに`,`か`_`を、
  2・8・16進数は4桁ごとに`_`を挿入可能

```python
"=== 10進数に対して ==="

print('{:,}'.format(1000000000))  # -> 1,000,000,000
print('{:_}'.format(1000000000))  # -> 1_000_000_000

"=== 2・8・16進数に対して ==="

print('{:_b}'.format(1000000000))
# -> 11_1011_1001_1010_1100_1010_0000_0000
print('{:_o}'.format(1000000000))  # -> 73_4654_5000
print('{:_x}'.format(1000000000))  # -> 3b9a_ca00
"「,」を指定するとエラー"
try:
    print('{:,b}'.format(100000000))
except ValueError as e:
    print(e)  # -> Cannot specify ',' with 'b'.

"浮動小数点数float型の場合は整数部にのみ区切りが入る。"
print('{:,}'.format(1234.56789))  # -> 1,234.56789
```

## 2進数、8進数、16進数

> 数値を2進数、8進数、16進数に変換して出力する。

> `b`:      2進数
  `o`:      8進数
  `d`:      10進数
  `x`, `X`: 16進数(大文字だとアルファベットが大文字表記)

```python
print('{:b}'.format(255))  # -> 11111111
print('{:o}'.format(255))  # -> 377
print('{:d}'.format(255))  # -> 255
print('{:x}'.format(255))  # -> ff
print('{:X}'.format(255))  # -> FF
```

> ゼロ埋めと組み合わせることもできる。
> 2進数や16進数表記のときは桁を合わせるためによく使う。

```python
print('{:08b}'.format(255))  # -> 11111111
print('{:08o}'.format(255))  # -> 00000377
print('{:08d}'.format(255))  # -> 00000255
print('{:08x}'.format(255))  # -> 000000ff
print('{:08X}'.format(255))  # -> 000000FF
```

> 書式指定子の先頭に`#`をつけると、
  `0b`や`0x`などの接頭辞が加えられる。
> ゼロ埋めの文字数は接頭辞も考慮して指定する必要があるので注意。

```python
print('{:#010b}'.format(255))  # -> 0b11111111
print('{:#010o}'.format(255))  # -> 0o00000377
print('{:#010d}'.format(255))  # -> 0000000255
print('{:#010x}'.format(255))  # -> 0x000000ff
print('{:#010X}'.format(255))  # -> 0X000000FF
```

> 2進数や16進数に書式を変換できるのは整数型intのみ。
> 中身が数字であっても文字列strだとValueErrorになる。
> `int()`で数値に変換すればOK。

```python
try:
    print('hex: {:08x}'.format('255'))
except ValueError as e:
    print(e)  # -> Unknown format code 'X' for object of type 'str'

print('hex: {:08x}'.format(int('255')))  # -> hex: 000000ff
```

> Pythonにおける2進数、8進数、16進数の数値・文字列の変換についての詳細は
  以下の記事を参照。
[関連記事](../../1.%20数値型/1.%20数値に関する変換.md#数値に関する変換)

## 小数点以下の桁数指定

> 小数点以下の桁数を指定するには、`.[桁数]f`とする。
> 整数部の桁数によらず小数点以下が指定した桁数になる。

```python
print('{:.2f}'.format(123.456))  # -> 123.46
print('{:.5f}'.format(123.456))  # -> 123.45600
print('{:.3f}'.format(0.0001234))  # -> 0.000
```

> 小数点の左側には上述の左寄せ、中央寄せ、右寄せ、ゼロ埋めの指定が可能。
> 全体の桁数が指定した桁数になるように処理される。
> 対象の値の桁数が指定した桁数よりも多い場合は何もされない。

```python
print('"{:>12.5f}"'.format(123.456))  # -> "   123.45600"
print('"{:012.5f}"'.format(123.456))  # -> "000123.45600"
print('"{:06.5f}"'.format(123.456))   # -> "123.45600"
```

> 小数点以下に元の桁数よりも少ない桁数を指定すると値が丸められる。
> 四捨五入ではなく偶数への丸めなので注意。
> 0.5が0に丸められたりする。

```python
print('{:.0f}'.format(0.4))  # -> 0
print('{:.0f}'.format(0.5))  # -> 0
print('{:.0f}'.format(0.6))  # -> 1
```

> 一般的な四捨五入にしたい場合は
  標準ライブラリ`decimal`の`quantize()`メソッドを使う方法がある。
[関連記事](../../1.%20数値型/2.%20端数処理.md)

## 指数表記

> 浮動小数点float型の数値を文字列strに変換すると、
  桁数によって自動で指数表記になる。
> 整数型intはならない。

```python
print('{}'.format(0.0001234))  # -> 0.0001234
print('{}'.format(0.00001234))  # -> 1.234e-05

print('{}'.format(1234000000000000.0))  # -> 1234000000000000.0
print('{}'.format(12340000000000000.0))  # -> 1.234e+16
print('{}'.format(12340000000000000000000000))
# -> 12340000000000000000000000
```

> 書式指定子に`e`または`E`を指定すると
  常に指数表記に変換することができる。
> 出力に使われる文字がそれぞれ`e`,`E`となる。

```python
print('{:e}'.format(0.0001234))  # -> 1.234000e-04
print('{:E}'.format(0.0001234))  # -> 1.234000E-04
```

> 小数点以下の桁数を指定することも可能。
> 整数部が常に1桁で小数点以下が指定した桁数になる。

```python
print('{:.5e}'.format(0.0001234))  # -> 1.23400e-04
print('{:.2E}'.format(0.0001234))  # -> 1.23E-04

print('{:.5e}'.format(987.65))  # -> 9.87650e+02
print('{:.2E}'.format(987.65))  # -> 9.88E+02
```

> 左寄せ、中央寄せ、右寄せ、ゼロ埋めの指定をした場合、
  `e-`や`E+`なども桁数(文字数)にカウントされるので注意。

```python
print('"{:>12.5e}"'.format(987.65))  # -> " 9.87650e+02"
print('"{:012.2E}"'.format(987.65))  # -> "00009.88E+02"
```

## 有効数字(有効桁数)

> `.[桁数]g`とすると全体の桁数を指定できる。
> 結果によって自動で指数表記になる。
> 小数点以下の末尾の`0`は省略されてしまうので注意。

```python
print('{:.2g}'.format(123.456))  # -> 1.2e+02
print('{:.3g}'.format(123.456))  # -> 123
print('{:.8g}'.format(123.456))  # -> 123.456
print('{:.3g}'.format(0.0001234))  # -> 0.000123
```

> `g`を省略してもほとんどの場合で同様だが、
  整数で出力されるような場合のみ出力が異なる。
> `g`を省略すると整数にならない。

```python
print('{:.2}'.format(123.456))  # -> 1.2e+02
print('{:.3}'.format(123.456))  # -> 1.23e+02
print('{:.8}'.format(123.456))  # -> 123.456
print('{:.3}'.format(0.0001234))  # -> 0.000123
```

> 同じ値を処理するとそれぞれ以下のようになる。

```python
print('{:.3f}'.format(123.456))  # -> 123.456
print('{:.3e}'.format(123.456))  # -> 1.235e+02
print('{:.3g}'.format(123.456))  # -> 123
print('{:.3}'.format(123.456))  # -> 1.23e+02

print('{:.8f}'.format(123.456))  # -> 123.45600000
print('{:.8e}'.format(123.456))  # -> 1.23456000e+02
print('{:.8g}'.format(123.456))  # -> 123.456
print('{:.8}'.format(123.456))  # -> 123.456
```

> `g`の場合や省略した場合は小数点以下の末尾の`0`は省略されてしまうので、
  有効数字(有効桁数)を合わせて出力したい場合は
  `e`または`E`の指数表記を使う。
> 整数部が常に1桁で小数点以下が指定した桁数になるので、
  有効数字n桁の場合はn-1を指定すればよい。

```python
print('{:.4e}'.format(123.456))  # -> 1.2346e+02
print('{:.4e}'.format(0.000012345))  # -> 1.2345e-05
print('{:.4e}'.format(12))  # -> 1.2000e+01
```

## パーセント表示

> 書式指定子に`%`を指定すると、
  数値floatまたはintの値を100倍して`%`を付けた文字列に変換する。

> 小数点以下の桁数を指定することも可能。
> デフォルトでは小数点以下が6桁。
> 左寄せ、中央寄せ、右寄せ、ゼロ埋めもできる。
> `%`も文字数にカウントされる。

```python
print('{:%}'.format(0.12345))  # -> 12.345000%
print('{:.2%}'.format(0.12345))  # -> 12.35%

print('{:%}'.format(10))  # -> 1000.000000%
print('{:.2%}'.format(10))  # -> 1000.00%

print('{:>7.2%}'.format(0.12345))  # ->  12.35%
print('{:07.2%}'.format(0.12345))  # -> 012.35%
```

# リンク

[note.nkmk.me](https://note.nkmk.me/python-format-zero-hex/)
[gammasoft.jp](https://gammasoft.jp/blog/python-string-format/)
[atmarkit.co.jp](https://www.atmarkit.co.jp/ait/articles/1904/23/news015.html)
