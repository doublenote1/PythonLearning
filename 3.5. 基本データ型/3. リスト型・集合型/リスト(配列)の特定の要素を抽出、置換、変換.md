> Pythonで、既存のリスト(配列)の特定の条件を満たす要素のみを
  抽出・削除したり置換や変換などの処理をしたりして
  新たなリストを生成するには、リスト内包表記を使う。

> 文字列のリストについての具体例は以下の記事を参照。
[](https://note.nkmk.me/python-list-str-select-replace/)

> 条件を満たす要素ではなく、ランダムに抽出することも可能。
[](https://note.nkmk.me/python-random-choice-sample-choices/)

> なお、リストは異なる型のデータを格納可能で、厳密には配列とは異なる。メモリサイズやメモリアドレスを必要とするような処理や大規模なデータの数値計算処理などで配列を扱いたい場合はarray(標準ライブラリ)やNumPyを使う。
[](https://note.nkmk.me/python-list-array-numpy-ndarray/)

# リスト内包表記の基本的な形

> リストから新たなリストを生成する場合は
  リスト内包表記を使うと`for`ループよりもシンプルに書ける。

`[式 for 任意の変数名 in イテラブルオブジェクト if 条件式]`

> イテラブル(リストやタプルなど)の条件式を満たす要素に式が適用され、
  新たなリストの要素となる。`if` 条件式は省略可能。

> ネストしたリスト内包表記など、詳しくは以下の記事を参照。
[](../../5.%20特殊構文/内包表記.md)

# リストの要素すべてに処理を適用

> 例えばリストの要素すべてに何らかの処理を適用したい場合は、
  上述のリスト内包表記の式に所望の処理を記述する。

```python
lst = list(range(-5, 6))
print(lst)  # -> [-5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5]

lst_square = [i**2 for i in lst]
print(lst_square)  # -> [25, 16, 9, 4, 1, 0, 1, 4, 9, 16, 25]
lst_str = [str(i) for i in lst]
print(lst_str)
# -> ['-5', '-4', '-3', '-2', '-1', '0', '1', '2', '3', '4', '5']
```

> 数値のリストと文字列のリストに変換についての詳細は以下の記事を参照。
[](4.%20文字列リスト・数値のリストの相互変換.md)

# リストから条件を満たす要素を抽出・削除

> 要素を条件式で選択するだけであれば式で処理することはないので、
  `[変数名 for 変数名 in 元のリスト if 条件式]`
  という形になる。

> 条件を満たす要素(条件式がTrueとなる要素)のみが抽出された
  新たなリストが生成される。

```python
lst = list(range(-5, 6))
print(lst)  # -> [-5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5]

lst_even = [i for i in lst if i % 2 == 0]
print(lst_even)  # -> [-4, -2, 0, 2, 4]
lst_minus = [i for i in lst if i < 0]
print(lst_minus)  # -> [-5, -4, -3, -2, -1]
```

```python
lst = list(range(-5, 6))
print(lst)  # -> [-5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5]

"""if 条件式をif not 条件式にすると否定になり、
条件を満たさない要素(条件式がFalseとなる要素)のみを選択して抽出、
つまり、条件を満たす要素が削除された新たなリストが生成される"""

lst_odd = [i for i in lst if not i % 2 == 0]
print(lst_odd)  # -> [-5, -3, -1, 1, 3, 5]
lst_plus = [i for i in lst if not i < 0]
print(lst_plus)  # -> [0, 1, 2, 3, 4, 5]

"もちろん、notを使わずに相当の条件式を指定しても同じ結果となる"

lst_odd = [i for i in lst if i % 2 != 0]
print(lst_odd)  # -> [-5, -3, -1, 1, 3, 5]
lst_plus = [i for i in lst if i >= 0]
print(lst_plus)  # -> [0, 1, 2, 3, 4, 5]

"""条件式の部分は複数条件にすることもできる。
複数の条件式をorやandでつなげればOK。否定notも使える。"""

l_minus_or_even = [i for i in lst if (i < 0) or (i % 2 == 0)]
print(l_minus_or_even)  # -> [-5, -4, -3, -2, -1, 0, 2, 4]
l_minus_and_odd = [i for i in lst if (i < 0) and not (i % 2 == 0)]
print(l_minus_and_odd)  # -> [-5, -3, -1]
```

# リストの条件を満たす要素を置換・変換

> 上述の要素の抽出の例では、条件を満たさない要素が取り除かれた。
> 条件を満たさない要素はそのままで条件を満たす要素に対して
  置換や変換などの処理を行いたい場合は、
  リスト内包表記の式の部分に三項演算子を適用する。
[](../../4.%20制御フロー/3.%20if%20文・三項演算子.md)

> Pythonでは三項演算子は以下のように書ける。
`真の値 if 条件式 else 偽の値`

```python
a = 80
x = 100 if a > 50 else 0
print(x)  # -> 100

b = 30
y = 100 if b > 50 else 0
print(y)  # -> 0
```

> リスト内包表記と三項演算子を組み合わせると以下のようになる。
`[真の値 if 条件式 else 偽の値 for 任意の変数名 in 元のリスト]`

> カッコで囲んだ部分が三項演算子(実際のコードではカッコは必要ない)。
`[(真の値 if 条件式 else 偽の値) for 任意の変数名 in 元のリスト]`

> 真の値や偽の値に任意の変数名をそのまま書けば
  元の要素の値がそのまま使われるし、
  何らかの式を書けばその式の処理が適用される。

```python
lst = list(range(-5, 6))
print(lst)  # -> [-5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5]

lst_replace = [100 if i > 0 else i for i in lst]
print(lst_replace)
# -> [-5, -4, -3, -2, -1, 0, 100, 100, 100, 100, 100]

lst_replace2 = [100 if i > 0 else 0 for i in lst]
print(lst_replace2)
# -> [0, 0, 0, 0, 0, 0, 100, 100, 100, 100, 100]

lst_convert = [i * 10 if i % 2 == 0 else i for i in lst]
print(lst_convert)
# -> [-5, -40, -3, -20, -1, 0, 1, 20, 3, 40, 5]

lst_convert2 = [i * 10 if i % 2 == 0 else i / 10 for i in lst]
print(lst_convert2)
# -> [-0.5, -40, -0.3, -20, -0.1, 0, 0.1, 20, 0.3, 40, 0.5]
```

# リンク

[](https://note.nkmk.me/python-list-select-replace/)
